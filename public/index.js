const t={width:640,height:360,t:document.querySelector("canvas"),s:document.querySelector("canvas").getContext("2d"),e:io({upgrade:!1,autoConnect:!1,transports:["websocket"]})};t.t.width=t.width,t.t.height=t.height;const s={clear:()=>{t.s.beginPath(),t.s.clearRect(0,0,t.width,t.height)},i:(s,e,i,h)=>{t.s.beginPath(),t.s.fillStyle=h,t.s.arc(s,e,i,0,2*Math.PI),t.s.fill()},h:(s,e,i,h,n)=>{t.s.fillStyle=n,t.s.fillRect(s,e,i,h)},n:(s,e,i,h,n)=>{t.s.strokeStyle=n,t.s.beginPath(),t.s.moveTo(s,e),t.s.lineTo(i,h),t.s.stroke()},c:(s,e,i,h,n,c)=>{t.s.font=h,t.s.textAlign=n,t.s.fillStyle=i,t.s.fillText(c,s,e)}},e={r:()=>t.e.open(),emit:(s,...e)=>t.e.emit(s,...e),on:(s,e)=>t.e.on(s,e),off:(...s)=>t.e.off(...s),a:t.e.close()};class i{static o(t){i.u(),i.d=(()=>t.d()),i.update=(()=>t.update()),i.fixedUpdate=(()=>t.fixedUpdate()),i.u=(()=>t.u()),i.d()}static d(){}static update(){}static fixedUpdate(){}static u(){}}i.f=localStorage,i.l=[{name:"Speedy",p:"#ffa"},{name:"Norman",p:"#aff"},{name:"Faf",p:"#faf"},{name:"Tanky",p:"#aaa"}];class h{static input(t,s){s?this.w(t):this.x(t)}}h.w=(t=>{}),h.x=(t=>{});class n{constructor(t=0,s=0){this.m=t,this.y=s}static add(t,s){return new n(t.m+s.m,t.y+s.y)}static sub(t,s){return new n(t.m-s.m,t.y-s.y)}static M(t,s){return new n(t*s.m,t*s.y)}static I(t,s){return new n(t.m/s,t.y/s)}static g(t){return new n(-t.m,-t.y)}static U(t,s){return t.m*s.m+t.y*s.y}static k(t){return 0!=t.m&&0!=t.y}static S(t,s){return n.U(t,s)/(t.v()*s.v())}v(){return Math.hypot(this.m,this.y)}b(t){return n.sub(this,t).v()}A(){return n.I(this,this.v())}F(t){return n.sub(n.M(2*n.U(this,t),t),this)}O(){return new n(this.m,this.y)}T(t){let s=n.U(this,t)/t.v();return new n(s,Math.sqrt(this.v()*this.v()-s*s))}}class c{static input(t,s,e){let i=new n(t,s);1==e?this.B=i:-1==e?(this.C?this.L(n.sub(this.B,i)):this.N(i),this.C=!1,this.B=new n(-1,-1)):-1!=this.B.m&&n.sub(this.B,i).v()>2&&(this.L(n.sub(this.B,i)),this.B=i,this.C=!0),c.D(i)}}c.B=new n(-1,-1),c.C=!1,c.L=(t=>{}),c.N=(t=>{}),c.D=(t=>{});class r{d(){}update(){}fixedUpdate(){}u(){}j(t,s,e){}q(t,s){}}class a{constructor(t=0,s=0){this.H=new n(t,s),this.J=1}draw(t){s.clear();for(const s of t)s.draw&&s.draw(this.H,this.J)}}class o{constructor(){this.K=null}}class u extends o{constructor(t=0,s=0,e=1,i=!1){super(),this.H=new n(t,s),this.P=new n(0,0),this.W=new n(0,0),this.Y=e,this.Z=i}}const d=400;class f extends o{constructor(t="red",s=100,e=!0){super(),this.p=t,this.z=e,this.G=s,this.Q=s}draw(t,e){if(!this.K)return;let{H:i,R:h}=this.K.V;this.X()&&s.h(Math.ceil(t.m+i.m-h)*e,Math.ceil(t.y+i.y-h-7)*e,Math.ceil(2*h*this.G/100)*e,3*e,this.p)}fixedUpdate(){}X(){return this.G>0?(this.z||(this.z=!0,this.G=this.Q),!0):(this.z?(this.z=!1,this.G=-d):this.G++,!1)}}class l extends u{constructor(t=0,s=0,e=1,i=1,h="#ccc"){super(t,s,i),this.R=e,this.p=h}draw(t,e){this.K.$.get(f.name)&&!this.K.$.get(f.name).z||s.i((t.m+this.H.m)*e,(t.y+this.H.y)*e,this.R*e,this.p)}}class p extends u{constructor(t=0,s=0,e=1,i=1,h=1,c="#555"){super(t,s,h),this._=new n(e,i),this.p=c}draw(t,e){this.K.$.get(f.name)&&!this.K.$.get(f.name).z||s.n((t.m+this.H.m)*e,(t.y+this.H.y)*e,(t.m+this._.m)*e,(t.y+this._.y)*e,this.p)}}class w extends o{constructor(t=null,s=.2){super(),this.tt=t,this.W=s}st(t,s=.2){return this.tt=t,this.W=s,this}et(){return this.tt}fixedUpdate(){if(!this.K||!this.K.V||!this.tt)return;const t=n.sub(this.K.V.H,this.tt);this.K.V.W=n.M(this.W,n.g(t.A())),t.v()<1&&(this.tt=null,this.K.V.W=new n)}}class x extends o{constructor(t="none"){super(),this.name=t}draw(t,e){if(!this.K)return;if(this.K.$.get(f.name)&&!this.K.$.get(f.name).z)return;let{H:i,R:h}=this.K.V;s.c(Math.ceil(t.m+i.m),Math.ceil(t.y+i.y+h+10),"#ccc","11px Impact","center",this.name)}}const m=1,y=1.2,M=3,I=.01;class g{it(t){for(const s of t.values())s.V.W=n.I(s.V.W,m),s.V.W.v()<I&&(s.V.W=new n),s.V.P=n.add(n.I(s.V.P,y),s.V.W),s.V.P.v()>M&&(s.V.P=n.M(M,s.V.P.A())),s.V.P.v()<I&&(s.V.P=new n),s.V.H=n.add(s.V.H,s.V.P)}ht(t,s){const e=[...t.values()];for(let t=0;t<e.length;t++)for(let i=t+1;i<e.length;i++)this.nt(e[t].V,e[i].V,t=>s(t))}nt(t,s,e){if(t.constructor.name===l.name&&s.constructor.name===l.name){if(n.sub(t.H,s.H).v()<=t.R+s.R){e(t.K),e(s.K);const i=n.sub(t.H,s.H),h=new n(i.y,-i.m),c=h.y/h.v(),r=h.m/h.v(),a=2*c*r,o=r*r-c*c;t.P=new n(t.P.m*o+t.P.y*a,t.P.m*a-t.P.y*o),s.P=new n(s.P.m*o+s.P.y*a,s.P.m*a-s.P.y*o),t.W=new n(t.W.m*o+t.W.y*a,t.W.m*a-t.W.y*o),s.W=new n(s.W.m*o+s.W.y*a,s.W.m*a-s.W.y*o),t.K.$.get(w.name)&&t.K.$.get(w.name).st(null),s.K.$.get(w.name)&&s.K.$.get(w.name).st(null)}}else if(t.constructor.name===l.name&&s.constructor.name===p.name){const i=n.sub(s.H,s._),h=i.v(),c=n.sub(s.H,t.H).v(),r=n.sub(s._,t.H).v();if(t.R>Math.sqrt(c**2-((c**2-r**2+h**2)/(2*h))**2)){e(t.K),e(s.K);let c=i.y/h,r=i.m/h,a=2*c*r,o=r*r-c*c;t.P=new n(t.P.m*o+t.P.y*a,t.P.m*a-t.P.y*o),t.W=new n(t.W.m*o+t.W.y*a,t.W.m*a-t.W.y*o)}}else t.constructor.name===p.name&&s.constructor.name===l.name?this.nt(s,t,e):t.constructor.name===p.name&&(s.constructor.name,p.name)}}class U{constructor(){this.ct=U.rt++,this.at=!0,this.$=new Map,this.V=null;const t=t=>(...s)=>{if(this.at)for(const e of this.$.values())e[t]&&e[t](...s)};["draw","update","fixedUpdate"].map(s=>this[s]=t(s))}add(t){t.K=this,this.$.set(t.constructor.name,t)}}U.rt=0;class k extends Map{constructor(t=1,s=1){super(),this.ot=t,this.ut=s}add(t){if(Array.isArray(t))for(const s of t)this.set(s.ct,s);else this.set(t.ct,t);return this}}class S extends r{constructor(t,s){super(),this.dt=s-1,this.ft=t}d(){this.lt=this.dt%2?new a(-300,-285):new a(350,350),this.pt=new g,this.wt=30099,this.dt%2?(this.xt=this.mt(-270,-270,1),this.yt=this.mt(870,570,0)):(this.xt=this.mt(870,570,1),this.yt=this.mt(-270,-270,0)),this.Mt=(new k).add([...this.ft.map((t,s)=>this.It(t,s)),...this.gt(),this.xt,this.yt]),c.L=(t=>{this.lt.H=n.sub(this.lt.H,t)}),c.N=(t=>{const s=n.sub(t,this.lt.H);e.emit("target",s.m,s.y)}),e.on("target",(t,s,e)=>{[...this.Mt.values()][t].$.get(w.name).st(new n(s,e))}),e.on("disconnect",()=>{i.o(new v)})}It(t,s){let e=s%2?800:-200,h=s%2?500:-200;s>1?(e-=20,h+=20):(e+=20,h-=20);const n=new U,c=i.l.filter(s=>s.name===t[1]).pop().p,r=s===this.dt?"#afa":s%2==this.dt%2?"#aaf":"#faa";return s==this.dt-1&&(this.Ut=n),n.V=new l(e,h,10,1,c),n.add(n.V),n.add(new f(r)),n.add(new w),n.add(new x(t[0])),n}mt(t,s,e){const i=new U;return i.V=new l(t,s,30),i.add(i.V),i.add(new f(e?"#faa":"#afa")),i}gt(){const t=[];return t.push(this.kt(-300,-300,-300,600)),t.push(this.kt(-300,600,900,600)),t.push(this.kt(900,600,900,-300)),t.push(this.kt(900,-300,-300,-300)),t}kt(t,s,e,i){const h=new U;return h.V=new p(t,s,e,i),h.add(h.V),h}update(){for(const t of this.Mt.values())t.update&&t.update();this.lt.draw(this.Mt.values()),this.St()}St(){s.c(320,20,"#fff","12px Impact","center",.01*this.wt|0),s.h(288,330,65,4,"#afa"),s.h(288,337,20,20,"#fff"),s.h(310,337,20,20,"#fff"),s.h(332,337,20,20,"#fff")}fixedUpdate(){for(const t of this.Mt.values())t.fixedUpdate&&t.fixedUpdate();this.pt.it(this.Mt),this.pt.ht(this.Mt,t=>{t.$.has(f.name)&&(t.$.get(f.name).G-=10)}),this.wt--,this.wt<0&&(e.emit("end",-1),i.o(new F))}u(){s.clear(),this.Mt.clear(),c.L=(t=>{}),c.N=(t=>{}),e.off()}}class v extends r{d(){s.clear(),s.c(30,70,"#fff","20px Impact","left","You're OFFLINE. Click to go back to the menu!"),h.w=(t=>this.vt()),c.N=(t=>this.vt())}u(){h.w=(t=>{}),c.N=(t=>{})}vt(){i.o(new F)}}const b=2;class A extends r{constructor(t,s){super(),this.Ut=[t,s]}d(){this.ft=[],s.clear(),e.r(),e.on("disconnect",()=>{i.o(new v)}),e.on("connect",()=>{e.emit("hello",...this.Ut)}),e.on("prepare",(t,s)=>{this.ft.push(...JSON.parse(s),this.Ut),this.dt=this.ft.length}),e.on("hello",(t,s)=>{this.ft.push([t,s])}),e.on("start",()=>{i.o(new S(this.ft,this.dt))})}update(){s.clear();this.ft.forEach((t,e)=>{const h=i.l.filter(s=>s.name===t[1]).pop();s.c(120+120*e,100+e%2*120-30-10,h.p,"14px Impact","center",t[0]),s.i(120+120*e,100+e%2*120,30,h.p),s.c(120+120*e,100+e%2*120+30+20,h.p,"14px Impact","center",h.name)});const t=2*b-this.ft.length;t>0?s.c(50,340,"#ccc","14px Impact","left","Waiting for "+t+" player"+(t>1?"s":"")):s.c(50,340,"#ccc","18px Impact","left","Prepare!")}u(){e.off()}}class F extends r{d(){this.name="AEIOU".charAt(5*Math.random())+Math.random().toString(36).slice(2,7).replace(/[\.0-9]/g,""),this.blink=0,this.bt=!1,this.At=!1,h.w=(t=>{13==t?i.o(new A(this.name,i.l[0].name)):8==t?this.name=this.name.slice(0,-1):16==t?this.bt=!0:t>64&&t<91?this.name+=String.fromCharCode(t+32*+!this.bt):t>47&&t<58&&(this.name+=t-48)}),h.x=(t=>{16==t&&(this.bt=!1)}),c.N=(t=>{const s=t=>this.At===t?33:30;i.l.forEach((e,h)=>{(t.m-(120+100*h))**2+(t.y-210)**2<=s(h)**2&&i.o(new A(this.name,e.name))})}),c.D=(t=>{this.At=!1;const s=t=>this.At===t?33:30;i.l.forEach((e,i)=>{(t.m-(120+100*i))**2+(t.y-210)**2<=s(i)**2&&(this.At=i)})})}update(){s.clear(),s.c(50,60,"#ccc","20px Impact","left","Enter your name and then choose class"),s.c(90,140,"#ccc","20px Impact","left",this.name+(this.blink>30?"|":""));const t=t=>this.At===t?33:30;i.l.forEach((e,i)=>{s.i(120+100*i,210,t(i),e.p),s.c(120+100*i,260,e.p,"14px Impact","center",e.name)}),this.blink=(this.blink+1)%60}u(){h.w=(t=>{}),h.x=(t=>{}),c.N=(t=>{}),c.D=(t=>{})}}const O=((t=0)=>(s=0,e=s-t)=>{for(;e>0;)i.fixedUpdate(),e-=10;t=s-e,setTimeout(()=>O(performance.now()),10)})();["mouseup","mousemove","mousedown"].forEach((s,e)=>t.t.addEventListener(s,s=>c.input(s.offsetX/t.t.offsetWidth*t.width,s.offsetY/t.t.offsetHeight*t.height,e-1),!0)),["keyup","keydown"].forEach((t,s)=>document.addEventListener(t,t=>h.input(t.keyCode,s),!0)),i.o(new class extends r{d(){this.Ft=500,h.w=(t=>this.vt()),c.N=(t=>this.vt())}update(){s.clear(),s.i(2*(400-this.Ft),200,60-(500-this.Ft)/500*60,"#ccc"),s.c(320,170,"#fff","60px Impact","center","The Circle Masters")}fixedUpdate(){--this.Ft<0&&this.vt()}u(){h.w=(t=>{}),c.N=(t=>{})}vt(){i.o(new F)}}),function t(){i.update(),requestAnimationFrame(t)}(),O();
